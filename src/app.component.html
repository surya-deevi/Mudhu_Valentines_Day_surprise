<!-- Background Canvas -->
<canvas #bgCanvas class="absolute inset-0 z-0 pointer-events-none"></canvas>

<!-- Loading Overlay -->
@if (isLoading()) {
  <div class="fixed inset-0 bg-white z-[1000] flex flex-col items-center justify-center transition-opacity duration-700 ease-out"
       [class.opacity-0]="!isLoading()">
    <div class="text-6xl mb-5 animate-[beat_0.8s_infinite_alternate]">üíù</div>
    <div class="w-52 h-1.5 bg-gray-200 rounded-full overflow-hidden relative">
      <div class="absolute left-0 top-0 h-full bg-[#ff4d6d] transition-all duration-300" 
           [style.width.%]="loadingProgress()"></div>
    </div>
    <div class="mt-4 font-bold text-[#ff85a1] text-sm uppercase tracking-widest">{{ loadingStatus() }}</div>
  </div>
}

<!-- Main Card -->
<div class="relative z-10 w-[90%] max-w-sm text-center transition-all duration-700 ease-[cubic-bezier(0.175,0.885,0.32,1.275)]"
     [class.opacity-100]="cardVisible()"
     [class.scale-100]="cardVisible()"
     [class.visible]="cardVisible()"
     [class.opacity-0]="!cardVisible()"
     [class.scale-90]="!cardVisible()"
     [class.invisible]="!cardVisible()">
  <div class="bg-white/30 backdrop-blur-xl border-2 border-white/50 rounded-[40px] p-6 sm:p-8 md:p-10 [@media(max-height:450px)]:p-4 shadow-2xl shadow-black/10">
    
    @switch (currentScreen()) {
      @case ('proposal') {
        <div class="flex flex-col items-center justify-center min-h-[350px] sm:min-h-[400px] [@media(max-height:450px)]:min-h-0">
          <h1 class="font-['Pacifico',_cursive] text-2xl sm:text-3xl md:text-4xl [@media(max-height:450px)]:text-2xl text-[#ff4d6d] mb-4 leading-tight">
            Happy Proposal Day!!!<br>My Love ‚ù§Ô∏è
          </h1>
          <div class="mt-8">
            <button class="py-3 px-8 text-lg sm:py-4 sm:px-10 sm:text-xl md:py-5 md:px-14 md:text-2xl bg-gradient-to-r from-[#ff4d6d] to-[#ff85a1] text-white rounded-full font-black cursor-pointer shadow-[0_10px_25px_rgba(255,77,109,0.4)] transition-transform duration-200 ease-out hover:scale-105 active:scale-100"
                    (click)="goToAskScreen()">
              Next ‚ù§Ô∏è
            </button>
          </div>
        </div>
      }
      @case ('ask') {
        <div>
          <h1 class="font-['Pacifico',_cursive] text-2xl sm:text-3xl md:text-4xl [@media(max-height:450px)]:text-2xl text-[#ff4d6d] mb-4 [@media(max-height:450px)]:mb-2 leading-tight">
            <span>{{ userName() }}</span>, will you be my Valentine?
          </h1>
          <div class="inline-block bg-white p-2 rounded-[20px] sm:p-2.5 sm:rounded-[24px] mb-4 sm:mb-6 [@media(max-height:450px)]:mb-3 shadow-lg shadow-black/5">
            <img class="block w-28 h-28 rounded-[14px] sm:w-32 sm:h-32 sm:rounded-[16px] md:w-40 md:h-40 md:rounded-[20px] [@media(max-height:450px)]:w-24 [@media(max-height:450px)]:h-24" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExYTNuNmMxNDA4Nnhyd2N6ZW9zaGI5bjNwaXZnOXNsajAzamloYmQ4aSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/lS7l4HG3tsAG0k8MoJ/giphy.gif" alt="cute gif" />
          </div>
          <div class="flex flex-col items-center gap-4 [@media(max-height:450px)]:gap-3 min-h-[140px] sm:min-h-40 [@media(max-height:450px)]:min-h-0">
            <button #yesBtn 
                    class="py-3 px-8 text-lg sm:py-4 sm:px-10 sm:text-xl md:py-5 md:px-14 md:text-2xl bg-gradient-to-r from-[#ff4d6d] to-[#ff85a1] text-white rounded-full font-black cursor-pointer shadow-[0_10px_25px_rgba(255,77,109,0.4)] transition-transform duration-200 ease-out z-10 hover:scale-105 active:scale-100"
                    [style.transform]="'scale(' + yesButtonScale() + ')'"
                    (click)="celebrate()">
              YES! ‚ù§Ô∏è
            </button>
            <div #noWrapper 
                class="relative z-20 flex flex-col items-center transition-all duration-300 ease-[cubic-bezier(0.175,0.885,0.32,1.1)]"
                [class.active-run]="isNoButtonRunning()"
                [style.position]="noButtonPosition()?.position"
                [style.left]="noButtonPosition()?.left"
                [style.top]="noButtonPosition()?.top"
                [style.transform]="noButtonPosition()?.transform">
              <button class="py-2 px-6 text-base sm:py-2 sm:px-7 md:py-3 md:px-9 md:text-lg [@media(max-height:450px)]:py-1 [@media(max-height:450px)]:px-5 [@media(max-height:450px)]:text-base bg-white text-[#ff4d6d] border-2 border-[#ffdce0] rounded-full font-bold pointer-events-none">
                No
              </button>
              <div class="flex gap-4 -mt-1.5 transition-opacity duration-300"
                  [class.opacity-100]="isNoButtonRunning()"
                  [class.opacity-0]="!isNoButtonRunning()">
                <div class="w-2.5 h-5 bg-[#ff4d6d] border-2 border-white rounded-full origin-top animate-[step_0.1s_infinite_alternate]"></div>
                <div class="w-2.5 h-5 bg-[#ff4d6d] border-2 border-white rounded-full origin-top animate-[step_0.1s_infinite_alternate-reverse]"></div>
              </div>
            </div>
          </div>
        </div>
      }
      @case ('success') {
        <div>
          <canvas #successCanvas class="fixed inset-0 z-[100] pointer-events-none"></canvas>
          <h1 class="font-['Pacifico',_cursive] text-2xl sm:text-3xl md:text-4xl [@media(max-height:450px)]:text-2xl text-[#ff4d6d] mb-4 [@media(max-height:450px)]:mb-2 leading-tight">
            Yay! Best Day Ever! üíñ
          </h1>
          <div class="inline-block bg-white p-2 rounded-[20px] sm:p-2.5 sm:rounded-[24px] mb-4 sm:mb-6 [@media(max-height:450px)]:mb-3 shadow-lg shadow-black/5">
            <img class="block w-28 h-28 rounded-[14px] sm:w-32 sm:h-32 sm:rounded-[16px] md:w-40 md:h-40 md:rounded-[20px] [@media(max-height:450px)]:w-24 [@media(max-height:450px)]:h-24" src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExZm83aG56Z3NmeDVwcHQydWhnOGNpZDYybHk1eDljMHhrb3RscDk1NyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1JmGiBtqTuehfYxuy9/giphy.gif" alt="success gif" />
          </div>
          <p class="text-gray-700 font-bold">
            My heart belongs to you! ü•∞
          </p>
          <div class="mt-8 pt-4 [@media(max-height:450px)]:mt-4 [@media(max-height:450px)]:pt-2 border-t border-white/50 flex flex-col items-center gap-2">
            <p class="text-sm text-gray-600 font-medium">Made with Love ‚ù§Ô∏è</p>
          </div>
        </div>
      }
    }

  </div>
</div>
